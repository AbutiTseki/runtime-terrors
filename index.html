<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Node Graph</title>
    <style>
        canvas {
            border: 1px solid #000;
        }
    </style>
</head>
<body>
    <canvas id="canvas" width="800" height="600"></canvas>
    <div>
        <input type="text" id="nodeName" placeholder="Node Name">
        <input type="button" value="Add Node" onclick="addNode()">
        <input type="button" value="Add Link" onclick="addLink()">
        <input type="text" id="sourceNode" placeholder="Source Node">
        <input type="text" id="targetNode" placeholder="Target Node">
        <input type="button" value="Delete Node" onclick="deleteNode()">
    </div>

    <script>
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        const nodes = [];
        const links = [];

        let selectedNode = null;

        function addNode() {
            const nodeName = document.getElementById("nodeName").value;
            if (!nodeName) return;

            const node = { x: 50, y: 50, name: nodeName };
            nodes.push(node);
            draw();
        }

        function addLink() {
            const sourceNodeName = document.getElementById("sourceNode").value;
            const targetNodeName = document.getElementById("targetNode").value;

            if (!sourceNodeName || !targetNodeName) {
                alert("Please enter both source and target node names.");
                return;
            }

            // Check if the source and target nodes exist
            const sourceNode = nodes.find(node => node.name === sourceNodeName);
            const targetNode = nodes.find(node => node.name === targetNodeName);

            if (!sourceNode || !targetNode) {
                alert("Source and/or target node does not exist.");
                return;
            }

            const link = { source: sourceNode.name, target: targetNode.name };
            links.push(link);
            draw();
        }

        function deleteNode() {
            if (selectedNode) {
                // Remove the selected node and associated links
                nodes.splice(nodes.indexOf(selectedNode), 1);
                links.splice(links.findIndex(link => link.source === selectedNode.name || link.target === selectedNode.name), 1);
                selectedNode = null;
                draw();
            }
        }

        canvas.addEventListener("mousedown", function (e) {
            const mouseX = e.clientX - canvas.getBoundingClientRect().left;
            const mouseY = e.clientY - canvas.getBoundingClientRect().top;

            // Check if a node is clicked
            for (const node of nodes) {
                const dx = node.x - mouseX;
                const dy = node.y - mouseY;
                const distance = Math.sqrt(dx * dx + dy * dy);
                if (distance < 20) {
                    if (selectedNode === node) {
                        // Toggle selection off
                        selectedNode = null;
                    } else {
                        // Select the clicked node
                        selectedNode = node;
                    }
                    break;
                }
            }

            draw();
        });

        canvas.addEventListener("mousemove", function (e) {
            if (selectedNode) {
                selectedNode.x = e.clientX - canvas.getBoundingClientRect().left;
                selectedNode.y = e.clientY - canvas.getBoundingClientRect().top;
                draw();
            }
        });

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw links
            for (const link of links) {
                const sourceNode = nodes.find(node => node.name === link.source);
                const targetNode = nodes.find(node => node.name === link.target);
                if (sourceNode && targetNode) {
                    ctx.beginPath();
                    ctx.moveTo(sourceNode.x, sourceNode.y);
                    ctx.lineTo(targetNode.x, targetNode.y);
                    ctx.stroke();
                }
            }

            // Draw nodes
            for (const node of nodes) {
                ctx.beginPath();
                ctx.arc(node.x, node.y, 20, 0, 2 * Math.PI);
                ctx.fillStyle = selectedNode === node ? "red" : "blue";
                ctx.fill();
                ctx.stroke();

                ctx.fillStyle = "white";
                ctx.font = "12px Arial";
                ctx.textAlign = "center";  // Center the text horizontally
                ctx.textBaseline = "middle";  // Center the text vertically
                ctx.fillText(node.name, node.x, node.y);
            }
        }

        draw();
    </script>
</body>
</html>
